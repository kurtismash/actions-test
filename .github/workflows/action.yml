name: TFLint

on:
  workflow_call:
  workflow_dispatch:

jobs:
  tflint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683

      - name: Setup TFLint with checksum verification
        uses: terraform-linters/tflint@90f302c255ef959cbfb4bd10581afecdb7ece3e6 # 4.1.1
        with:
          tflint_version: v0.58.0
          checksums: |
            ed96be4460a35c5110449fd00056c86530e876b7d88456a443e971ee1e002976  tflint_darwin_amd64.zip
            b422a402296dfa8685a231f24b5ed046792d4b48e772034c22b11391cad8b2e1  tflint_darwin_arm64.zip
            f996acb16970491ef9d71664d18ef9e3eb2c6b0c5340e1fe2f992d98f5392ea2  tflint_linux_386.zip
            1e8ccdf3e4b57ba154545b4343621bf46f25ca8f5cc97e36432469752f7ef0c0  tflint_linux_amd64.zip
            949cb81cc6697d7255bdee21c80159e75986bd986f2cf01a75a57b776a46ad14  tflint_linux_arm.zip
            7500c93e69ba0f37a4bb5f403cdbaec7230fa65044f39affa1939d8e0df01ad9  tflint_linux_arm64.zip
            78eb37da4a4b257e255f38081c10884ebfa810d75f8418f947f401585475b23e  tflint_windows_386.zip
            5320933d7b33987b5c452035b84b81d58c5f38cf22ff68d0a3db24ffeb939180  tflint_windows_amd64.zip

      - name: Initialise & Install TFLint AWS Ruleset Plugin
        run: tflint --init

      - name: Run TFLint
        run: tflint
